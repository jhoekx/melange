{% extends "melange.html" %}
{% block title %}{{ tag.name }}{% endblock %}
{% block head %}
<link rel="stylesheet" href="/static/varsmodel.css">

<style>
.items {
    float: right;
}
.items h2:first-of-type {
    margin-top: 0;
}
.items li {
    list-style-type: none;
    background-color: #ccc;
    border: 1px solid #aaa;
    margin:0.5em;
    padding: 0.2em;
}
.items a {
    line-height: 160%;
}
</style>
{% endblock %}
{% block content %}

<h1>{{ tag.name }}</h1>

<div class="items">
<h2>Items</h2>
<ul>
    <li>
        <form method="POST" action="/item/">
        <input type="text" name="item-name" size="30"> <input type="hidden" name="tag-name" value="{{ tag.name }}"><input type="submit" name="item-add" value="Add">
        </form>
    </li>
{% for item in tag.items|sort(attribute='name') %}
    <li><a href="{{ url_for('show_item',name=item.name) }}">{{ item.name }}</a>
{% endfor %}
</ul>
</div>

<h2>Properties</h2>
<div id="var-editor">
<table>
{% for variable in var_list|sort(attribute='key') %}
    <tr>
        <td>{{ variable.key }}
{% if variable.type == 'Text' %}
        <td>
            <form method="POST"><input type="hidden" name="var-key" value="{{ variable.key }}">
            <p><input name="var-value" value="{{ variable.value }}" size="50">
               <input type="submit" name="var-text-save" value="Save">
            </form>
        </td>
{% elif variable.type == 'List' %}
        <td>
            <form method="POST">
            <ul>
{% for item in variable.value %}
                <li><input name="var-value[]" value="{{ item }}" size="50" placeholder="Value">
                    <input type="checkbox" name="var-select[]" value="{{ loop.index }}">
{% endfor %}
            </ul>
            <p>
                <input type="hidden" name="var-key" value="{{ variable.key }}">
                <input type="submit" name="var-list-add" value="Add">
                <input type="submit" name="var-list-save" value="Save" >
                <input type="submit" name="var-list-remove" value="Remove">
            </form>
        </td>
{% elif variable.type == 'Map' %}
        <td>
            <form method="POST">
            <ul>
{% for k, v in variable.value|dictsort %}
                <li><input name="var-value-key[]" value="{{ k }}" placeholder="Key">
                :
                <input name="var-value-value[]" value="{{ v }}" placeholder="Value">
                <input type="checkbox" name="var-select[]" value="{{ k }}">
{% endfor %}
            </ul>
            <p>
                <input type="hidden" name="var-key" value="{{ variable.key }}">
                <input type="submit" name="var-map-add" value="Add">
                <input type="submit" name="var-map-save" value="Save" >
                <input type="submit" name="var-map-remove" value="Remove">
            </form>
{% endif %}
        <td>
            <form method="POST"><input type="hidden" name="var-key" value="{{ variable.key }}"><input type="submit" name="var-remove" value="Remove"></form>
        </td>
{% endfor %}
</table>

<form method="POST">
<p>
    <input name="var-key" size="50" placeholder="New variable" required>
    <select name="var-type">
        <option>Text</option>
        <option>List</option>
        <option>Map</option>
    </select>
    <input type="submit" name="var-add" value="Add">
</form>

</div>

<h2>Remove</h2>
<form method="POST">
<p><input type="submit" name="tag-remove" value="Remove {{ tag.name }}">
</form>
{% endblock %}
